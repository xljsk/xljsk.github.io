(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36062f98"],{"13d5":function(e,t,a){"use strict";var s=a("23e7"),i=a("d58f").left,r=a("a640"),o=a("2d00"),c=a("605d"),l=!c&&o>79&&o<83,n=l||!r("reduce");s({target:"Array",proto:!0,forced:n},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},"1e28":function(e){e.exports=JSON.parse('{"grinning":{"keywords":["face","smile","happy","joy",":D","grin"],"char":"😀","fitzpatrick_scale":false,"category":"people"},"grin":{"keywords":["face","happy","smile","joy","kawaii"],"char":"😁","fitzpatrick_scale":false,"category":"people"},"smiley":{"keywords":["face","happy","joy","haha",":D",":)","smile","funny"],"char":"😃","fitzpatrick_scale":false,"category":"people"},"smile":{"keywords":["face","happy","joy","funny","haha","laugh","like",":D",":)"],"char":"😄","fitzpatrick_scale":false,"category":"people"},"sweat_smile":{"keywords":["face","hot","happy","laugh","sweat","smile","relief"],"char":"😅","fitzpatrick_scale":false,"category":"people"},"laughing":{"keywords":["happy","joy","lol","satisfied","haha","face","glad","XD","laugh"],"char":"😆","fitzpatrick_scale":false,"category":"people"},"innocent":{"keywords":["face","angel","heaven","halo"],"char":"😇","fitzpatrick_scale":false,"category":"people"},"wink":{"keywords":["face","happy","mischievous","secret",";)","smile","eye"],"char":"😉","fitzpatrick_scale":false,"category":"people"},"blush":{"keywords":["face","smile","happy","flushed","crush","embarrassed","shy","joy"],"char":"😊","fitzpatrick_scale":false,"category":"people"},"slightly_smiling_face":{"keywords":["face","smile"],"char":"🙂","fitzpatrick_scale":false,"category":"people"},"yum":{"keywords":["happy","joy","tongue","smile","face","silly","yummy","nom","delicious","savouring"],"char":"😋","fitzpatrick_scale":false,"category":"people"},"heart_eyes":{"keywords":["face","love","like","affection","valentines","infatuation","crush","heart"],"char":"😍","fitzpatrick_scale":false,"category":"people"},"kissing_heart":{"keywords":["face","love","like","affection","valentines","infatuation","kiss"],"char":"😘","fitzpatrick_scale":false,"category":"people"},"kissing":{"keywords":["love","like","face","3","valentines","infatuation","kiss"],"char":"😗","fitzpatrick_scale":false,"category":"people"},"kissing_smiling_eyes":{"keywords":["face","affection","valentines","infatuation","kiss"],"char":"😙","fitzpatrick_scale":false,"category":"people"},"kissing_closed_eyes":{"keywords":["face","love","like","affection","valentines","infatuation","kiss"],"char":"😚","fitzpatrick_scale":false,"category":"people"},"stuck_out_tongue_winking_eye":{"keywords":["face","prank","childish","playful","mischievous","smile","wink","tongue"],"char":"😜","fitzpatrick_scale":false,"category":"people"},"stuck_out_tongue_closed_eyes":{"keywords":["face","prank","playful","mischievous","smile","tongue"],"char":"😝","fitzpatrick_scale":false,"category":"people"},"stuck_out_tongue":{"keywords":["face","prank","childish","playful","mischievous","smile","tongue"],"char":"😛","fitzpatrick_scale":false,"category":"people"},"sunglasses":{"keywords":["face","cool","smile","summer","beach","sunglass"],"char":"😎","fitzpatrick_scale":false,"category":"people"},"roll_eyes":{"keywords":["face","eyeroll","frustrated"],"char":"🙄","fitzpatrick_scale":false,"category":"people"},"flushed":{"keywords":["face","blush","shy","flattered"],"char":"😳","fitzpatrick_scale":false,"category":"people"},"rage":{"keywords":["angry","mad","hate","despise"],"char":"😡","fitzpatrick_scale":false,"category":"people"},"confused":{"keywords":["face","indifference","huh","weird","hmmm",":/"],"char":"😕","fitzpatrick_scale":false,"category":"people"},"tired_face":{"keywords":["sick","whine","upset","frustrated"],"char":"😫","fitzpatrick_scale":false,"category":"people"},"triumph":{"keywords":["face","gas","phew","proud","pride"],"char":"😤","fitzpatrick_scale":false,"category":"people"},"fearful":{"keywords":["face","scared","terrified","nervous","oops","huh"],"char":"😨","fitzpatrick_scale":false,"category":"people"},"disappointed_relieved":{"keywords":["face","phew","sweat","nervous"],"char":"😥","fitzpatrick_scale":false,"category":"people"},"sleepy":{"keywords":["face","tired","rest","nap"],"char":"😪","fitzpatrick_scale":false,"category":"people"},"sweat":{"keywords":["face","hot","sad","tired","exercise"],"char":"😓","fitzpatrick_scale":false,"category":"people"},"dizzy_face":{"keywords":["spent","unconscious","xox","dizzy"],"char":"😵","fitzpatrick_scale":false,"category":"people"},"astonished":{"keywords":["face","xox","surprised","poisoned"],"char":"😲","fitzpatrick_scale":false,"category":"people"},"sneezing_face":{"keywords":["face","gesundheit","sneeze","sick","allergy"],"char":"🤧","fitzpatrick_scale":false,"category":"people"},"mask":{"keywords":["face","sick","ill","disease"],"char":"😷","fitzpatrick_scale":false,"category":"people"},"face_with_thermometer":{"keywords":["sick","temperature","thermometer","cold","fever"],"char":"🤒","fitzpatrick_scale":false,"category":"people"},"face_with_head_bandage":{"keywords":["injured","clumsy","bandage","hurt"],"char":"🤕","fitzpatrick_scale":false,"category":"people"},"sleeping":{"keywords":["face","tired","sleepy","night","zzz"],"char":"😴","fitzpatrick_scale":false,"category":"people"},"zzz":{"keywords":["sleepy","tired","dream"],"char":"💤","fitzpatrick_scale":false,"category":"people"},"clap":{"keywords":["hands","praise","applause","congrats","yay"],"char":"👏","fitzpatrick_scale":true,"category":"people"},"call_me_hand":{"keywords":["hands","gesture"],"char":"🤙","fitzpatrick_scale":true,"category":"people"},"+1":{"keywords":["thumbsup","yes","awesome","good","agree","accept","cool","hand","like"],"char":"👍","fitzpatrick_scale":true,"category":"people"},"-1":{"keywords":["thumbsdown","no","dislike","hand"],"char":"👎","fitzpatrick_scale":true,"category":"people"},"facepunch":{"keywords":["angry","violence","fist","hit","attack","hand"],"char":"👊","fitzpatrick_scale":true,"category":"people"},"fist":{"keywords":["fingers","hand","grasp"],"char":"✊","fitzpatrick_scale":true,"category":"people"},"v":{"keywords":["fingers","ohyeah","hand","peace","victory","two"],"char":"✌","fitzpatrick_scale":true,"category":"people"},"ok_hand":{"keywords":["fingers","limbs","perfect","ok","okay"],"char":"👌","fitzpatrick_scale":true,"category":"people"},"raised_hand":{"keywords":["fingers","stop","highfive","palm","ban"],"char":"✋","fitzpatrick_scale":true,"category":"people"},"raised_back_of_hand":{"keywords":["fingers","raised","backhand"],"char":"🤚","fitzpatrick_scale":true,"category":"people"},"muscle":{"keywords":["arm","flex","hand","summer","strong","biceps"],"char":"💪","fitzpatrick_scale":true,"category":"people"},"handshake":{"keywords":["agreement","shake"],"char":"🤝","fitzpatrick_scale":false,"category":"people"},"point_left":{"keywords":["direction","fingers","hand","left"],"char":"👈","fitzpatrick_scale":true,"category":"people"},"point_right":{"keywords":["fingers","hand","direction","right"],"char":"👉","fitzpatrick_scale":true,"category":"people"},"fu":{"keywords":["hand","fingers","rude","middle","flipping"],"char":"🖕","fitzpatrick_scale":true,"category":"people"},"raised_hand_with_fingers_splayed":{"keywords":["hand","fingers","palm"],"char":"🖐","fitzpatrick_scale":true,"category":"people"},"lips":{"keywords":["mouth","kiss"],"char":"👄","fitzpatrick_scale":false,"category":"people"},"ear":{"keywords":["face","hear","sound","listen"],"char":"👂","fitzpatrick_scale":true,"category":"people"},"eyes":{"keywords":["look","watch","stalk","peek","see"],"char":"👀","fitzpatrick_scale":false,"category":"people"},"santa":{"keywords":["festival","man","male","xmas","father christmas"],"char":"🎅","fitzpatrick_scale":true,"category":"people"},"sun_with_face":{"keywords":["nature","morning","sky"],"char":"🌞","fitzpatrick_scale":false,"category":"animals_and_nature"},"crescent_moon":{"keywords":["night","sleep","sky","evening","magic"],"char":"🌙","fitzpatrick_scale":false,"category":"animals_and_nature"},"star":{"keywords":["night","yellow"],"char":"⭐","fitzpatrick_scale":false,"category":"animals_and_nature"},"zap":{"keywords":["thunder","weather","lightning bolt","fast"],"char":"⚡","fitzpatrick_scale":false,"category":"animals_and_nature"},"fire":{"keywords":["hot","cook","flame"],"char":"🔥","fitzpatrick_scale":false,"category":"animals_and_nature"},"snowflake":{"keywords":["winter","season","cold","weather","christmas","xmas"],"char":"❄️","fitzpatrick_scale":false,"category":"animals_and_nature"},"soccer":{"keywords":["sports","football"],"char":"⚽","fitzpatrick_scale":false,"category":"activity"},"basketball":{"keywords":["sports","balls","NBA"],"char":"🏀","fitzpatrick_scale":false,"category":"activity"},"football":{"keywords":["sports","balls","NFL"],"char":"🏈","fitzpatrick_scale":false,"category":"activity"},"baseball":{"keywords":["sports","balls"],"char":"⚾","fitzpatrick_scale":false,"category":"activity"},"gift":{"keywords":["present","birthday","christmas","xmas"],"char":"🎁","fitzpatrick_scale":false,"category":"objects"},"tada":{"keywords":["party","congratulations","birthday","magic","circus","celebration"],"char":"🎉","fitzpatrick_scale":false,"category":"objects"},"black_nib":{"keywords":["pen","stationery","writing","write"],"char":"✒️","fitzpatrick_scale":false,"category":"objects"},"memo":{"keywords":["write","documents","stationery","pencil","paper","writing","legal","exam","quiz","test","study","compose"],"char":"📝","fitzpatrick_scale":false,"category":"objects"},"heart":{"keywords":["love","like","valentines"],"char":"❤️","fitzpatrick_scale":false,"category":"symbols"},"yellow_heart":{"keywords":["love","like","affection","valentines"],"char":"💛","fitzpatrick_scale":false,"category":"symbols"},"green_heart":{"keywords":["love","like","affection","valentines"],"char":"💚","fitzpatrick_scale":false,"category":"symbols"},"vs":{"keywords":["words","orange-square"],"char":"🆚","fitzpatrick_scale":false,"category":"symbols"},"speech_balloon":{"keywords":["bubble","words","message","talk","chatting"],"char":"💬","fitzpatrick_scale":false,"category":"symbols"},"clock1":{"keywords":["time","late","early","schedule"],"char":"🕐","fitzpatrick_scale":false,"category":"symbols"}}')},5463:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"letter-warp"},[t("div",{staticClass:"tabs"},[t("div",{staticClass:"header-box"},[e._v(" "+e._s(e.$t("letter_private_letter"))+" ")]),t("div",{staticClass:"tabs-box"},e._l(e.dataList,(function(a,s){var i;return t("div",{key:s,class:"tabs-item "+(e.activeItem===a.userId?"active":""),on:{click:function(t){return e.activeUser(a)}}},[t("Avatar",{attrs:{nicknameStyle:" width: 110px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;",avatarSize:42,isShowNickname:!0,userId:a.userId}},[t("div",{staticClass:"text",attrs:{slot:"bottom"},slot:"bottom"},[e._v(e._s(e.handleLink(a.history)))])]),t("div",{staticClass:"time"},[e._v(" "+e._s(e.$dayjs(a.history&&(null===(i=a.history[a.history.length-1])||void 0===i?void 0:i.created)).format("YYYY/MM/DD HH:mm"))+" ")])],1)})),0)]),t("div",{staticClass:"content"},[t("div",{staticClass:"header-box",staticStyle:{height:"95px"}},[t("Avatar",{attrs:{avatarSize:60,isShowNickname:!0,userId:e.activeItem}})],1),t("div",{staticClass:"content-box"},[t("div",{staticClass:"tips",style:"display:"+e.tipsStyle},[t("span",[e._v(" "+e._s(e.$t("letter_present_all"))+" ")]),t("i",{staticClass:"el-icon-close tips-icon",on:{click:function(t){e.tipsStyle="none"}}})]),t("div",{ref:"content",staticClass:"content-ee"},[e.data.history?[e._l(e.data.history,(function(a,s){return t("div",{key:s,staticClass:"content-item-data"},[a.fromClient!=e.userInfo.customerId?t("div",{staticClass:"item-data-left"},[t("Avatar",{attrs:{avatarSize:30,isShowNickname:!0,userId:a.fromClient}},[a.msgBody?t("div",{staticClass:"data-bottom",attrs:{slot:"bottom"},slot:"bottom"},["0"==JSON.parse(a.msgBody).type?t("div",[e._v(" "+e._s(JSON.parse(a.msgBody).message)+" ")]):e._e(),"1"==JSON.parse(a.msgBody).type?t("div",{staticStyle:{display:"flex","flex-direction":"column"}},e._l(JSON.parse(JSON.parse(a.msgBody).message),(function(e,s){return t("el-image",{key:s,staticStyle:{width:"100px","margin-bottom":"10px"},attrs:{src:e,"preview-src-list":JSON.parse(JSON.parse(a.msgBody).message)}})})),1):e._e()]):e._e()])],1):t("div",{staticClass:"item-data-right",staticStyle:{display:"flex","justify-content":"flex-end"}},[t("Avatar",{attrs:{nicknameBoxStyle:"margin-right:10px;font-size:12px' : 'margin-left:10px;font-size:12px",avatarBoxStyle:"flex-direction: row-reverse;",avatarSize:30,isShowNickname:!0,userId:a.fromClient}},[t("div",{staticClass:"data-bottom data-bottom-right",attrs:{slot:"bottom"},slot:"bottom"},["0"==JSON.parse(a.msgBody).type?t("span",[e._v(" "+e._s(JSON.parse(a.msgBody).message)+" ")]):e._e(),"1"==JSON.parse(a.msgBody).type?t("div",e._l(JSON.parse(JSON.parse(a.msgBody).message),(function(e,s){return t("el-image",{key:s,staticStyle:{width:"100px","margin-bottom":"10px"},attrs:{src:e,"preview-src-list":JSON.parse(JSON.parse(a.msgBody).message)}})})),1):e._e()])])],1)])})),e.isFollowTwoWay?e._e():t("div",{staticClass:"is-follow"},[e._v(" "+e._s(e.$t("letter_Since_all"))+" ")])]:e._e()],2),t("div",{staticClass:"but-box"},[t("div",{staticClass:"input-box"},[t("el-input",{attrs:{type:"textarea",rows:e.rows,maxlength:"140",placeholder:`回复${e.userInfoName.nickName}:`},on:{focus:e.focusInput,blur:e.blurInput},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),t("div",{staticClass:"icon-box"},[t("el-upload",{staticClass:"upload-demo",attrs:{multiple:"","auto-upload":!1,action:"","on-change":e.handleChange,"file-list":e.fileList,"show-file-list":!1,limit:9}},[t("svg-icon",{staticStyle:{"margin-right":"20px"},attrs:{data_iconName:"file1"}})],1),t("div",{staticStyle:{"margin-right":"20px",cursor:"pointer"},on:{click:function(t){e.expressionShow=!0}}},[t("svg-icon",{attrs:{data_iconName:"phiz1"}})],1),e.expressionShow?t("div",{staticClass:"biaoqing-warp",on:{click:function(t){e.expressionShow=!1}}}):e._e(),e.expressionShow?t("div",{staticClass:"biaoqing-box"},e._l(e.faceList,(function(a,s){return t("div",{key:s,staticClass:"expression-box-item",on:{click:function(t){t.stopPropagation(),e.$throttle(()=>e.getBrow(s))}}},[e._v(" "+e._s(a)+" ")])})),0):e._e()],1)],1),t("div",{staticClass:"submit",on:{click:function(t){return e.send("0")}}},[e._v(" "+e._s(e.$t("community_send"))+" ")])])])])])},i=[],r=(a("14d9"),a("13d5"),a("2f62")),o=a("6ca8"),c=a.n(o),l=a("1e28"),n=a("8055"),p=a.n(n),f=a("d78d"),h={data(){return{tipsStyle:"flex",dataList:[],data:{history:[]},fileList:[],activeItem:"",Socket:null,message:"",messageImgUrl:"",rows:1,faceList:[],expressionShow:!1,isFollowTwoWay:!0,userInfoName:{}}},computed:{...Object(r["d"])({userInfo:e=>e.userInfo,token:"token"})},watch:{},mounted(){this.getList(),this.faceContent(),document.querySelector(".content-ee").addEventListener("scroll",this.scrolling),this.Socket=p()(this.$getEnv("VUE_APP_LIVE_SOCKET_URL"),{path:"/message",transports:["websocket","polling"]}),this.Socket.on("connect",()=>{this.token&&this.Socket.emit("login",JSON.stringify({agent:this.$getEnv("VUE_APP_AGENT_SOCKET"),username:this.userInfo.customerId,source:"pc",sex:1,avatar:"tu_o"}))}),this.Socket.on("CHAT_MESSAGE_EVENT",e=>{e.fromClient==this.data.userId&&this.notifyRead(e),e.fromClient!=this.userInfo.customerId&&this.dataList.map((t,a)=>{if(t.userId==e.fromClient){let a=t.history||[];a.push(e),this.$set(t,"history",a)}}),e.toClient!=this.userInfo.customerId&&this.dataList.map((t,a)=>{if(t.userId==e.toClient){let a=t.history||[];a.push(e),this.$set(t,"history",a)}}),this.scrollOn()})},methods:{async notifyRead(e){console.log(e),await this.$api.notice.readByMsg({toClient:e.toClient,fromClient:e.fromClient,outMsgType:e.outMsgType})},async onGetUserAvatarInfo(e){const t=await Object(f["a"])([e]);if(200===t.code){const e=t.data[0];e&&(this.userInfoName={...e})}},async isFollowTwoWayfn(){const e=await this.$api.community.isFollowTwoWay({userId:this.userInfo.customerId,targetUserId:this.data.userId});e.success&&(this.isFollowTwoWay=2==e.obj)},scrolling(){let e=document.querySelector(".content-ee").scrollTop;this.data.isPaging||0!==e||this.getMsgHistory(this.data,!0)},getBrow(e){for(let t in this.faceList)e==t&&(this.message+=this.faceList[e]);this.expressionShow=!1},faceContent(){for(let e in l)this.faceList.push(l[e].char)},async send(e){if("0"==e&&!this.message.trim())return this.$notify({message:this.$t("community_enter_content"),type:"warning"});const t=await this.$api.community.ctmessageSendMsg({message:"1"==e?JSON.stringify([this.messageImgUrl]):this.message,messageType:e,targetUserId:this.data.userId});t.success&&(this.$notify({message:this.$t(t.code),type:"success"}),this.message="")},async addpicture(e){let t=new FormData;t.append("file",e.file);const a=await this.$api.mine.uploadApi(t);a.success&&(this.messageImgUrl=`${this.$getEnv("VUE_APP_ALIOSS_URL")}/${a.obj.toString()}`,this.send("1"),this.fileList=[])},handleChange(e){const t="image/jpg"===e.raw.type,a="image/png"===e.raw.type,s="image/jpeg"===e.raw.type;if(console.log(e.raw.type),!t&&!a&&!s)return this.$notify({message:this.$t("account_center_pictures"),type:"warning"}),!1;c()(e.raw,{quality:.2}).then(e=>{let t=e.origin.name,a=e.origin.type,s=new File([e.file],t,{type:a});this.addpicture({file:s})}).catch(e=>{this.$handleError.handleApiRequestException(e)})},focusInput(){this.rows=7},blurInput(){this.rows=1},scrollOn(){this.$nextTick(()=>{var e=this.$el.querySelector(".content-ee");e.scrollTop=e.scrollHeight})},activeUser(e){this.tipsStyle="flex",this.message="",this.activeItem=e.userId,this.data=e,this.onGetUserAvatarInfo(this.activeItem),this.isFollowTwoWayfn(),this.scrollOn(),this.notifyRead({toClient:this.userInfo.customerId,fromClient:e.userId,outMsgType:"ctDirectMsg"})},handleLink(e){let t="";var a,s;e&&0!==e.length&&(null!==(a=e[e.length-1])&&void 0!==a&&a.msgBody?(e=JSON.parse(null===(s=e[e.length-1])||void 0===s?void 0:s.msgBody),t=0==e.type?e.message:`[${this.$t("community_picture")}]`):t=`[${this.$t("community_picture")}]`);return t},async getMsgHistory(e,t){if(t){const t=await this.$api.community.getMsgHistory({targetUserId:e.userId,limit:10,time:this.$dayjs(this.data.history[0].created).format("YYYY/MM/DD HH:mm:ss")});if(t.success){0==t.obj.length&&this.$set(e,"isPaging",!0);let a=[...t.obj.reverse(),...e.history];this.$set(e,"history",a)}}else{const t=await this.$api.community.getMsgHistory({targetUserId:e.userId,limit:10});t.success&&(this.$set(e,"history",t.obj.reverse()),this.scrollOn())}},async getList(){const e=await this.$api.community.getChatListByFrom();if(this.dataList=[],e.success){const t=[...e.obj.targetUserIds,...e.obj.toMeUseIds];this.$route.query.id&&t.push({userId:this.$route.query.id});const a="userId";this.dataList=t.reduce((e,t)=>e.some(e=>e[a]==t[a])?e:[...e,t],[]),this.dataList.map((e,t)=>{0===t&&(this.activeItem=e.userId||"",this.data=this.dataList[0]||{}),this.$route.query.id,this.$route.query.id&&this.$route.query.id==e.userId&&(this.activeItem=e.userId||"",this.data=e,this.activeUser(e)),this.getMsgHistory(e)})}}}},d=h,y=(a("68d0"),a("2877")),u=Object(y["a"])(d,s,i,!1,null,"0ccc9c39",null);t["default"]=u.exports},"605d":function(e,t,a){(function(t){var s=a("c6b6");e.exports="undefined"!=typeof t&&"process"==s(t)}).call(this,a("4362"))},"68d0":function(e,t,a){"use strict";a("f484")},a640:function(e,t,a){"use strict";var s=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&s((function(){a.call(null,t||function(){return 1},1)}))}},d58f:function(e,t,a){var s=a("59ed"),i=a("7b0b"),r=a("44ad"),o=a("07fa"),c=TypeError,l=function(e){return function(t,a,l,n){s(a);var p=i(t),f=r(p),h=o(p),d=e?h-1:0,y=e?-1:1;if(l<2)while(1){if(d in f){n=f[d],d+=y;break}if(d+=y,e?d<0:h<=d)throw c("Reduce of empty array with no initial value")}for(;e?d>=0:h>d;d+=y)d in f&&(n=a(n,f[d],d,p));return n}};e.exports={left:l(!1),right:l(!0)}},f484:function(e,t,a){}}]);