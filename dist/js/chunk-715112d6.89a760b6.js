(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-715112d6"],{"0829":function(t,s,e){"use strict";e("51d2")},"09bf":function(t,s,e){},4213:function(t,s,e){"use strict";e("bac8")},"51d2":function(t,s,e){},b4bc6:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"content-wrap"},[s("div",{staticClass:"content-wrap-left"},[s("div",{staticClass:"content-wrap-hd"},[t.token?s("PersonalInformation",{attrs:{isLeader:t.isLeader}}):t._e(),t.token?s("PublishPost"):t._e()],1),s("PostList",{ref:"postListRef"})],1),s("div",{staticClass:"content-wrap-right",attrs:{id:"right"}},[s("div",{class:{"right-position":t.isFixed,"right-hotposition":t.isHotFixed},attrs:{id:"rightwrap"}},[s("SearchHot"),s("HotPost"),t.token?s("MyAttention"):t._e()],1)])])},o=[],n=e("2f62"),h=e("16ae"),a=e("769f"),l=(e("14d9"),function(){var t=this,s=t._self._c;return s("div",[t._l(t.showList,(function(e,i){return s("div",{key:e.id,staticClass:"wrap",on:{click:function(s){return t.$router.push(`/community/community-post/${e.id}/${e.author}`)}}},[s("Post",{attrs:{item:e,index:i},on:{handle:t.handle,deletePost:t.deletePost}})],1)})),0==t.showList.length?s("el-empty",{attrs:{image:e("e335"),"image-size":133,description:t.$t("notice_no_data")}}):s("div",{staticClass:"load-more"},[t._v(t._s(t.totalRows===t.showList.length?t.$t("notice_copy_over"):t.$t("notice_copy_load_more"))+" ")])],2)}),r=[],c=e("bd46"),d={name:"WorkspaceJsonPostList",components:{Post:c["a"]},data(){return{prefixUrl:"https://bandex-dev.oss-cn-shenzhen.aliyuncs.com",page:1,size:10,totalRows:0,showList:[],isLoadingNextPage:!1,hasMore:!1,change:0}},computed:{...Object(n["d"])(["token","userInfo","community"])},watch:{community(t){this.hasMore=!1,1===t?this.getTrendsList(!0):2===t?this.getTrendsListByHot(!0):3===t&&this.getMyFollowTrends(!0),window.scrollTo(0,0)}},mounted(){1===this.community?this.getTrendsList(!0):2===this.community?this.getTrendsListByHot(!0):3===this.community&&this.getMyFollowTrends(!0),window.addEventListener("scroll",this.scrollBottom)},destroyed(){window.removeEventListener("scroll",this.scrollBottom)},methods:{scrollBottom(){let t=document.documentElement.scrollTop||document.body.scrollTop,s=document.documentElement.scrollHeight||document.body.scrollHeight;s-t<=2700&&this.isLoadingNextPage&&(1===this.community?this.getTrendsList(!1):2===this.community?this.getTrendsListByHot(!1):3===this.community&&this.getMyFollowTrends(!1),this.isLoadingNextPage=!1)},deletePost(t){this.showList.splice(t,1)},handle(t,s){if(0===t)for(let e of this.showList)e.id==s&&(e.isLike=!1,e.up=e.up-1);if(1===t)for(let e of this.showList)e.id==s&&(e.isLike=!0,e.up=e.up+1);if(2===t)for(let e of this.showList)e.author==s&&(e.isFollow=!0);if(3===t)for(let e of this.showList)e.author==s&&(e.isFollow=!1)},async getTrendsList(t){if(t&&(this.page=1),!this.hasMore)try{const s=await this.$api.community.getTrendsList({page:this.page,size:this.size});if(s.success&&s.obj.data){let e=s.obj.data;if(this.totalRows=s.obj.totalRows,1===this.page&&0===e.length)return this.showList=e;e.length>0&&this.handleData(e,t),this.page*this.size<=this.totalRows&&(this.page=this.page+1),e.length<this.size&&(this.hasMore=!0)}}catch(s){this.$handleError.handleApiRequestException(s)}},async getTrendsListByHot(t){if(t&&(this.page=1),!this.hasMore)try{const s=await this.$api.community.getTrendsListByHot({page:this.page,size:this.size});if(s.success&&s.obj.data){let e=s.obj.data;if(this.totalRows=s.obj.totalRows,1===this.page&&0===e.length)return this.showList=e;e.length>0&&this.handleData(e,t),this.page*this.size<=this.totalRows&&(this.page=this.page+1),e.length<this.size&&(this.hasMore=!0)}}catch(s){this.$handleError.handleApiRequestException(s)}},async getMyFollowTrends(t){if(this.token){if(t&&(this.page=1),!this.hasMore)try{const s=await this.$api.community.getMyFollowTrends({page:this.page,size:this.size,userId:this.userInfo.customerId});if(s.success&&s.obj.data){let e=s.obj.data;if(this.totalRows=s.obj.totalRows,1===this.page&&0===e.length)return this.showList=e;e.length>0&&this.handleData(e,t),this.page*this.size<=this.totalRows&&(this.page=this.page+1),e.length<this.size&&(this.hasMore=!0)}}catch(s){this.$handleError.handleApiRequestException(s)}}else this.showList=[]},async handleData(t,s){if(t.forEach(t=>{if(t.attachContent){let s=JSON.parse(t.attachContent),e=[];s&&(s.map(s=>{1===s.type&&(t.href=this.$utils.decodeURIComponentSafely(s.url)),2===s.type&&e.push(this.prefixUrl+"/"+s.url),3===s.type&&(t.videoUrl=s.url)}),e.length&&(t.urls=e))}}),t.length>0){const e=await this.checkIsLikeTrends(t);for(let s of t)for(let t in e)s.id==t&&(s.isLike=e[t]);const i=await this.checkIsFollow(t);for(let s of t)for(let t in i)s.author==t&&(s.isFollow=i[t]);this.showList=s?t:this.showList.concat(t),this.isLoadingNextPage=!0}},async checkIsLikeTrends(t){try{if(!this.token)return;const s=[];if(t&&t.length>0)for(let i of t)s.push(i.id);const e=await this.$api.community.checkIsLikeTrends({trendsIds:String(s)});return e.obj}catch(s){this.$handleError.handleApiRequestException(s)}},async checkIsFollow(t){try{if(!this.token)return;const s=[];if(t&&t.length>0)for(let i of t)s.push(i.author);const e=await this.$api.community.checkIsFollow({userIds:String(s)});return e.obj}catch(s){this.$handleError.handleApiRequestException(s)}}}},u=d,f=(e("f1a8"),e("2877")),p=Object(f["a"])(u,l,r,!1,null,"7173ef98",null),g=p.exports,w=e("1943"),m=e("e671"),y=function(){var t=this,s=t._self._c;return s("div",{staticClass:"hot"},[s("div",{staticClass:"hot-title"},[t._v(t._s(t.$t("community_my_focus")))]),s("div",{staticClass:"hot-box"},[t._l(t.showList,(function(e){return s("div",{key:e.id,staticClass:"hot-list"},[s("div",{staticClass:"hot-list-left"},[s("Avatar",{attrs:{avatarSize:42,nicknameStyle:"width: 130px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;",userId:e.followUserId,isShowNickname:!0}},[s("div",{staticClass:"hot-list-author-detail",attrs:{slot:"bottom"},slot:"bottom"},[t._v(t._s(t.$dayjs(e.created).format("YYYY/MM/DD")))])])],1),s("div",{staticClass:"hot-list-right",on:{click:function(s){return t.onFollowClick(e)}}},[t._v(t._s(e.isFollow?t.$t("community_unsubscribe"):t.$t("community_focus"))+" ")])])})),0==t.showList.length?s("el-empty",{attrs:{image:e("e335"),"image-size":133,description:t.$t("notice_no_data")}}):t._e()],2)])},L=[],b={name:"MyAttention",data(){return{fits:["fill","contain","cover","none","scale-down"],url:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg",page:1,size:10,totalRows:0,showList:[],flag:!1}},computed:{...Object(n["d"])(["token"])},mounted(){this.getFollows()},methods:{async getFollows(){try{const t=await this.$api.community.getFollows({page:this.page,size:this.size});if(t.success&&t.obj.records){let s=t.obj.records;this.totalRows=t.obj.totalRows,s.length>0&&this.handleData(s),this.page*this.size<=this.totalRows&&(this.page=this.page+1)}}catch(t){this.$handleError.handleApiRequestException(t)}},async handleData(t){if(t.length>0){const s=await this.checkIsFollow(t);for(let e of t)for(let t in s)e.followUserId==t&&(e.isFollow=s[t]);this.showList=this.showList.concat(t)}},async checkIsFollow(t){try{if(!this.token)return;const s=[];if(t&&t.length>0)for(let i of t)s.push(i.followUserId);const e=await this.$api.community.checkIsFollow({userIds:String(s)});return e.obj}catch(s){this.$handleError.handleApiRequestException(s)}},onFollowClick(t){this.token?(t.isFollow?this.cancelFollow(t.followUserId):this.follow(t.followUserId),this.flag=!0):this.$router.push("/login")},async cancelFollow(t){try{if(this.flag)return;const s=await this.$api.community.cancelFollow({followUserId:t});if(s.success){this.flag=!1,this.$notify({message:this.$t(s.code),type:"success"});for(let s of this.showList)s.followUserId==t&&(s.isFollow=!1)}}catch(s){this.flag=!1,this.$handleError.handleApiRequestException(s)}},async follow(t){try{if(this.flag)return;const s=await this.$api.community.follow({followUserId:t});if(s.success){this.flag=!1,this.$notify({message:this.$t(s.code),type:"success"});for(let s of this.showList)s.followUserId==t&&(s.isFollow=!0)}}catch(s){this.flag=!1,this.$handleError.handleApiRequestException(s)}}}},k=b,$=(e("4213"),Object(f["a"])(k,y,L,!1,null,"2ea93e6b",null)),v=$.exports,I={name:"WorkspaceJsonIndex",components:{PersonalInformation:h["a"],PublishPost:a["a"],PostList:g,SearchHot:w["a"],HotPost:m["a"],MyAttention:v},data(){return{screenHeight:"",isFixed:!1,isHotFixed:!1,offsetTop:20,rightHeight:0,isLeader:!1}},computed:{...Object(n["d"])(["token","userInfo","community","communityRefresh"])},watch:{communityRefresh(){setTimeout(()=>{1===this.community?this.$refs.postListRef.getTrendsList(!0):2===this.community?this.$refs.postListRef.getTrendsListByHot(!0):3===this.community&&this.$refs.postListRef.getMyFollowTrends(!0)},1e3),window.scrollTo(0,0)}},mounted(){this.token&&this.checkLeader(),window.addEventListener("scroll",this.initHeight),this.screenHeight=document.body.clientHeight,window.onresize=()=>(()=>{this.screenHeight=document.body.clientHeight})()},destroyed(){window.removeEventListener("scroll",this.initHeight)},methods:{initHeight(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(this.token){var s=document.getElementById("rightwrap");this.rightHeight=s.offsetHeight,this.isFixed=t>=this.rightHeight-this.screenHeight;var e=document.getElementById("rightwrap"),i=this.rightHeight-this.screenHeight+20;e.style.top=`-${Math.abs(i)}px`}else this.isHotFixed=t>20},async checkLeader(){try{const t=await this.$api.community.checkLeader({userId:this.userInfo.customerId});t.success&&(this.isLeader=t.obj)}catch(t){this.$handleError.handleApiRequestException(t)}}}},F=I,_=(e("0829"),Object(f["a"])(F,i,o,!1,null,"0d6fc592",null));s["default"]=_.exports},bac8:function(t,s,e){},f1a8:function(t,s,e){"use strict";e("09bf")}}]);