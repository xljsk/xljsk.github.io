(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-214c9e4d"],{"10e9":function(t,e,i){},"16ae":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"personal"},[e("div",{staticClass:"personal-left"},[e("Avatar",{attrs:{avatarSize:60,userId:t.userInfo.customerId,isShowNickname:!0,nicknameBoxStyle:{marginLeft:"20px",fontSize:"18px",fontWeight:500,color:"#3D3D3D",cursor:"pointer"}}})],1)])},n=[],o=i("2f62"),a=i("df3a"),l={name:"WorkspaceJsonPersonalInformation",components:{Avatar:a["a"]},data(){return{prefixUrl:"https://bandex-dev.oss-cn-shenzhen.aliyuncs.com",infoData:{}}},mounted(){},computed:{...Object(o["d"])(["userInfo"])},methods:{}},r=l,c=(i("60df"),i("2877")),d=Object(c["a"])(r,s,n,!1,null,"317850e0",null);e["a"]=d.exports},"28f4":function(t,e,i){},"60df":function(t,e,i){"use strict";i("28f4")},"65fa":function(t,e,i){"use strict";i("10e9")},"769f":function(t,e,i){"use strict";var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post"},[e("div",{staticClass:"post-hd"},[e("div",{ref:"divRef",staticClass:"editor",attrs:{id:"editor",contenteditable:t.isEditable,"data-placeholder":t.$t("community_share_news")},on:{keyup:t.handkeKeyUp,input:t.valueChange,keydown:t.handkeKeyDown}})]),t.linkIsShow&&t.linkIipsShow&&1===t.current?e("div",{staticClass:"link"},[e("div",[e("div",{staticClass:"link-left-hd"},[t._v(t._s(t.$t("community_add_link")))]),e("div",{staticClass:"link-left-bd"},[t._v(t._s(t.$t("community_link_tips")))])]),e("div",{on:{click:function(e){t.linkIipsShow=!1}}},[e("svg-icon",{attrs:{data_iconName:"close",className:"link-right",size:16}})],1)]):t._e(),t.linkIsShow&&1===t.current?e("div",{staticClass:"link-content"},[e("div",{staticClass:"link-content-left"},[e("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:t.$t("community_enter_content")},model:{value:t.linkUrl,callback:function(e){t.linkUrl=e},expression:"linkUrl"}})],1),e("div",{on:{click:function(e){t.linkUrl=""}}},[e("svg-icon",{attrs:{data_iconName:"close",className:"link-content-right",size:16},on:{click:function(e){t.linkUrl=""}}})],1)]):t._e(),t.pictureDisplay&&2===t.current?e("div",{staticClass:"upload-pictures"},[e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","list-type":"picture-card","auto-upload":!1,"on-exceed":t.handleExceed,"on-preview":t.handlePictureCardPreview,"on-remove":t.handleRemove,"on-change":t.handleChange,limit:9,multiple:""}},[e("i",{staticClass:"el-icon-plus"})]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1):t._e(),3===t.current&&t.videoUrl&&!t.videoLoading?e("div",{staticClass:"post-video"},[e("video",{staticStyle:{width:"100%",height:"100%"},attrs:{controls:"controls",src:t.videoUrl}},[t._v(" "+t._s(t.$t("community_support_video"))+" ")])]):t._e(),3===t.current&&t.videoLoading?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.videoLoading,expression:"videoLoading"}],staticClass:"video-loading"}):t._e(),e("p",{staticStyle:{display:"none"}},[e("el-upload",{attrs:{action:"","file-list":t.fileListVideo,"auto-upload":!0,"http-request":t.handleUpload,"before-upload":t.beforeUpload}})],1),e("div",{staticClass:"post-bd"},[e("div",{staticClass:"post-bd-left"},t._l(t.uploadList,(function(i,s){return e("div",{key:s,staticClass:"post-bd-left-box",class:{select:t.current===i.id},on:{click:function(e){return t.uploadModus(i)}}},[e("svg-icon",{class:{selected:t.current===i.id},attrs:{data_iconName:i.data_iconName,className:"post-left-icon",size:20}}),t._v(" "+t._s(i.title)+" ")],1)})),0),e("div",{staticClass:"post-bd-right",on:{click:t.onSubmit}},[t._v(t._s(t.$t("community_post_news")))])]),e("AtDialog",{attrs:{showDialog:t.showDialog},on:{close:t.closeDialog,confirm:t.confirm}})],1)},n=[],o=(i("14d9"),i("6ca8")),a=i.n(o),l=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{title:t.$t("community_my_focus"),visible:t.dialogVisible,width:"280px"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.handleClose,open:t.getFollows}},[e("div",{staticClass:"search-box"},[e("el-input",{attrs:{placeholder:t.$t("community_search_user"),"prefix-icon":"el-icon-search"},on:{input:t.searchUser},model:{value:t.searchVal,callback:function(e){t.searchVal=e},expression:"searchVal"}})],1),(""==t.searchVal?t.dataList.length>0:t.searchList.length>0)?e("div",{staticClass:"user-list"},t._l(""==t.searchVal?t.dataList:t.searchList,(function(i){return e("div",{key:i.followUserId,staticClass:"list-item"},[e("Avatar",{attrs:{userId:i.followUserId,avatarSize:42,isShowNickname:!0,isGoPage:!1,nicknameBoxStyle:"margin-left:10px;font-size:14px"}}),e("div",{staticClass:"btn",class:i.select?"not-allow":"",on:{click:function(e){return t.select(i)}}},[t._v(t._s(t.$t("community_select"))+" ")])],1)})),0):e("el-empty",{staticStyle:{"min-height":"320px"},attrs:{image:i("e335"),"image-size":133,description:t.$t("notice_no_data")}})],1)],1)},r=[],c=i("2f62"),d={props:{showDialog:{type:Boolean,default:!1}},data(){return{dialogVisible:!1,searchVal:"",size:10,page:1,total:0,dataList:[],hasMore:!0,searchList:[]}},computed:{...Object(c["d"])({userInfo:t=>t.userInfo})},mounted(){},watch:{showDialog(t){this.dialogVisible=t}},methods:{searchUser(t){if(this.searchVal){let e=[];for(const i of this.dataList)i.nickName.includes(t)&&e.push(i);this.searchList=e}else this.searchList=[]},select(t){t.select||(this.$emit("confirm",{name:t.nickName,id:t.followUserId}),this.$emit("close"))},handleClose(){this.$emit("close"),this.searchList=[],this.searchVal=""},checkIsSelect(){let t=document.getElementById("editor").getElementsByTagName("a"),e=[];for(const i of t)e.push(i.id);for(const i of this.dataList)e.length>0?i.select=e.some(t=>t==i.followUserId):i.select=!1},async getFollows(){try{if(this.dataList.length>0&&this.checkIsSelect(),!this.hasMore)return;const t=await this.$api.community.getFollows({page:this.page,size:this.size,userId:this.userInfo.customerId});if(t.success&&t.obj.records){this.total=t.obj.total;for(const e of t.obj.records)e.select=!1;this.dataList=t.obj.records,this.page*this.size<this.total?this.hasMore=!0:this.hasMore=!1}}catch(t){this.$handleError.handleApiRequestException(t)}}}},h=d,u=(i("dbf7"),i("2877")),p=Object(u["a"])(h,l,r,!1,null,"3f41edfb",null),m=p.exports,f=i("d432"),g=i("bc3a"),v=i.n(g);const y=function(t,e){return new Promise((i,s)=>{f["a"].getUploadConfig().then(n=>{if(!n.success)return;const o=n.obj.dir+"/"+(new Date).getTime()+Math.floor(150*Math.random())+e,a=new FormData;a.append("key",o),a.append("success_action_status","200"),a.append("x-oss-object-acl","public-read"),a.append("policy",n.obj.policy),a.append("OSSAccessKeyId",n.obj.accessId),a.append("signature",n.obj.signature),a.append("x-oss-meta-fullname",t.name),a.append("file",t),v()({url:n.obj.host,method:"POST",data:a,processData:!1,cache:!1,contentType:!1}).then(()=>{i(`${n.obj.host}/${o}`)}).catch(t=>{s(t)})})})};var w=i("df7c"),_=i.n(w),b={name:"WorkspaceJsonPublishPost",components:{AtDialog:m},data(){return{uploadList:[{title:this.$t("community_picture"),id:2,data_iconName:"document"},{title:this.$t("community_video"),id:3,data_iconName:"video"},{title:this.$t("community_link"),id:1,data_iconName:"link"},{title:this.$t("community_at"),id:4,data_iconName:"@"}],current:"",linkIsShow:!1,linkIipsShow:!0,content:"",linkUrl:"",fileList:[],videoUrl:"",pictureDisplay:!1,dialogImageUrl:"",dialogVisible:!1,imgcount:0,titleImageArr:[],pictureUrl:"",arr:[],fileListVideo:[],prefixUrl:"https://bandex-dev.oss-cn-shenzhen.aliyuncs.com",durationNumber:null,videoLoading:!1,showDialog:!1,node:"",endIndex:"",isEditable:!0,innerHTML:"",maxLength:140,isMaxLength:!1,divNode:[]}},mounted(){this.$nextTick(()=>{this.node=document.getElementById("editor"),this.node.addEventListener("paste",this.paste)})},beforeDestroy(){this.node.removeEventListener("paste",this.paste)},watch:{async imgcount(t){t==this.fileList.length&&(this.imgcount=0,await this.addpicture(this.titleImageArr),await this.post())},current(t){""===t&&(this.linkUrl="",this.fileList="",this.videoUrl="",this.fileListVideo=[],this.arr=[])}},methods:{isUrl(t){return/^(?:(?:https?|ftp):\/\/)?(?:[\da-z.-]+)\.(?:[a-z.]{2,6})(?:\/\w\.-]*)*\/?/.test(String(t))},trim(t,e="both"){return"both"==e?t.replace(/^\s+|\s+$/g,""):"left"==e?t.replace(/^\s*/,""):"right"==e?t.replace(/(\s*$)/g,""):"all"==e?t.replace(/\s+/g,""):t},paste(t){t.preventDefault();let e=null;const i=document.createElement("span");e=window.clipboardData&&window.clipboardData.setData?window.clipboardData.getData("text"):(t.originalEvent||t).clipboardData.getData("text/plain"),i.textContent=e,this.node.appendChild(i);let s=document.getElementById("editor");this.content=s.innerText,this.keepLastIndex(this.node)},valueChange(t){const e=[...t.target.childNodes];let i=e.some(t=>"DIV"==t.nodeName);if(i){for(const e of t.target.childNodes)"DIV"==e.nodeName&&this.divNode.push(e);this.node=this.divNode[this.divNode.length-1]}else this.divNode=[],this.node=document.getElementById("editor");this.content=t.target.innerText,this.innerHTML=t.target.innerHTML},handkeKeyUp(){const t=window.getSelection().focusOffset;this.endIndex=t,"\n"==this.content&&(document.getElementById("editor").innerHTML="")},handkeKeyDown(t){"@"==t.key&&(t.preventDefault(),this.isEditable=!1,this.showDialog=!0)},closeDialog(){this.showDialog=!1,this.isEditable=!0,this.current=""},confirm(t){this.createAtButton(t)},createAtButton(t){const e=document.createElement("a"),i=document.createElement("span"),s=document.createElement("span");i.textContent=" ",s.textContent=" ",e.style.color="#edd44e",e.textContent="@"+t.name,e.setAttribute("id",t.id),e.setAttribute("contenteditable",!1);let n=document.getElementById("editor").getElementsByTagName("br");for(const a of n)a.parentElement.removeChild(a);const o=this.node.nextSibling;o?this.node.insertBefore(e,o):(this.node.appendChild(s),this.node.appendChild(e),this.node.appendChild(i)),setTimeout(()=>{this.keepLastIndex(this.node)},500)},keepLastIndex(t){if(window.getSelection){t.focus();let e=window.getSelection();e.selectAllChildren(t),e.collapseToEnd()}else if(document.selection){let e=document.selection.createRange();e.moveToElementText(t),e.collapse(!1),e.select()}},uploadModus(t){this.current=t.id,1===this.current?this.linkIsShow=!0:this.linkIsShow=!1,2===this.current?this.pictureDisplay=!0:this.pictureDisplay=!1,3===this.current?this.insertImage():this.videoUrl="",4===this.current&&(this.showDialog=!0)},insertImage(){document.getElementsByClassName("el-upload__input").file.click()},async handleUpload({file:t}){let e=null;e=_.a.extname(t.name),this.videoLoading=!0;const i=await y(t,e);this.videoLoading=!1,this.videoUrl=i},beforeUpload(t){const e=["video/mp4","video/ogg","video/flv","video/avi","video/wmv","video/rmvb","video/mov"].includes(t.type),i=t.size/1024/1024>100;return e||(this.$notify({type:"warning",message:this.$t("community_video_format")}),this.current=""),i&&(this.$notify({type:"warning",message:this.$t("community_video_exceed")}),this.current=""),e&&!i},handleChange(t,e){const i=t.size/1024/1024<4;if(!i)return this.$refs.upload.handleRemove(t,e),void this.$notify({type:"warning",message:this.$t("community_uploaded_images")});let s=t.name.split(".")[t.name.split(".").length-1];if("jpg"!==s&&"png"!==s&&"jpeg"!==s&&"bmp"!=s)return this.$refs.upload.handleRemove(t,e),void this.$notify({type:"warning",message:this.$t("otc_format")});this.fileList=e,this.fileList.length>=9&&(document.getElementsByClassName("el-upload--picture-card")[0].style.display="none")},handleRemove(t,e){this.fileList=e,this.fileList.length<9&&setTimeout(()=>{document.getElementsByClassName("el-upload--picture-card")[0].style.display=""},1e3)},handlePictureCardPreview(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleExceed(){this.$notify({type:"warning",message:this.$t("community_images_limit")})},async addpicture(t){var e=new FormData;if(2===this.current)for(let s of t)e.append("file",s.file);3===this.current&&(e.append("file",t.raw),this.videoLoading=!0);try{const t=await this.$api.community.addFile(e);t.success?(2===this.current&&t.obj.forEach(t=>{this.arr.push({type:2,url:"/"+t})}),3===this.current&&(this.videoUrl=this.prefixUrl+"/"+t.obj[0]),this.videoLoading=!1):this.videoLoading=!1}catch(i){this.videoLoading=!1,this.$handleError.handleApiRequestException(i)}},async onSubmit(){if(this.content||this.linkUrl||0!=this.fileList.length||this.videoUrl){if(""===this.content.trim())return this.$notify({type:"warning",message:this.$t("community_post_content")});if(this.content.trim().length<10)return this.$notify({type:"warning",message:this.$t("community_characters")});if(""==this.current)return this.$notify({type:"warning",message:this.$t("community_must")});if(this.arr=[],1==this.current){if(!this.isUrl(this.trim(this.linkUrl)))return this.$notify({message:this.$t("community_enter_url"),type:"warning"});this.arr.push({type:1,url:encodeURIComponent(this.linkUrl)}),this.$throttle(this.post)}if(2==this.current)for(let t of this.fileList)a()(t.raw,{quality:.2}).then(t=>{let e=t.origin.name,i=t.origin.type,s=new File([t.file],e,{type:i});this.titleImageArr.push({file:s}),this.imgcount++}).catch(t=>{this.$handleError.handleApiRequestException(t)});3==this.current&&(this.arr.push({type:3,url:this.videoUrl}),this.$throttle(this.post))}},async post(){let t=document.getElementById("editor");this.innerHTML=t.innerHTML.replace(/\n/g,"<br/>");let e=encodeURIComponent(`<p>${this.innerHTML}</p>`),i=[],s=t.getElementsByTagName("a");for(const o of s)i.push(o.id);const n=await this.$api.community.post({content:e,attachContent:0==this.arr.length?null:JSON.stringify(this.arr),specReminder:String(i)});n.success?(this.$notify({title:this.$t("notice_title_success"),message:this.$t("community_published_successfully"),type:"success"}),this.current="",this.node.innerText="",this.node.innerHTML="",this.content="",this.innerHTML="",this.titleImageArr=[],this.$emit("cancelModus"),this.$store.commit("UPDATE_COMMUNITY_REFRESH")):this.current=""}}},k=b,$=(i("65fa"),Object(u["a"])(k,s,n,!1,null,"19cb3411",null));e["a"]=$.exports},dbf7:function(t,e,i){"use strict";i("f94e")},f94e:function(t,e,i){}}]);