(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-612f00be"],{"13d5":function(t,e,s){"use strict";var i=s("23e7"),o=s("d58f").left,a=s("a640"),r=s("2d00"),n=s("605d"),c=!n&&r>79&&r<83,u=c||!a("reduce");i({target:"Array",proto:!0,forced:u},{reduce:function(t){var e=arguments.length;return o(this,t,e,e>1?arguments[1]:void 0)}})},"605d":function(t,e,s){(function(e){var i=s("c6b6");t.exports="undefined"!=typeof e&&"process"==i(e)}).call(this,s("4362"))},"60d3":function(t,e,s){},"6e8d":function(t,e,s){"use strict";s("7c94")},"7c94":function(t,e,s){},a640:function(t,e,s){"use strict";var i=s("d039");t.exports=function(t,e){var s=[][t];return!!s&&i((function(){s.call(null,e||function(){return 1},1)}))}},d58f:function(t,e,s){var i=s("59ed"),o=s("7b0b"),a=s("44ad"),r=s("07fa"),n=TypeError,c=function(t){return function(e,s,c,u){i(s);var d=o(e),l=a(d),h=r(d),p=t?h-1:0,m=t?-1:1;if(c<2)while(1){if(p in l){u=l[p],p+=m;break}if(p+=m,t?p<0:h<=p)throw n("Reduce of empty array with no initial value")}for(;t?p>=0:h>p;p+=m)p in l&&(u=s(u,l[p],p,d));return u}};t.exports={left:c(!1),right:c(!0)}},efcc:function(t,e,s){"use strict";s("60d3")},f908:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page"},[t._c_isShow_nav_wrap?e("div",{staticClass:"nav-wrap"},[e("SidebarNav",{attrs:{privateList:t.privateList,routesConfig:t.routesConfig,width:"300"},on:{click:t.navClick}})],1):t._e(),e("router-view",{staticClass:"container",attrs:{privateList:t.privateList},on:{"update:privateList":function(e){t.privateList=e},"update:private-list":function(e){t.privateList=e}}})],1)},o=[],a=(s("14d9"),s("13d5"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"sidebar-wrap pointer",style:{width:isNaN(t.width)?"300px":t.width+"px"}},[e("div",{staticClass:"title"},[t._v(t._s(t.routesConfig.title))]),e("div",{staticClass:"list-wrap"},t._l(t.routesConfig.routes,(function(s,i){var o,a;return e("div",{key:i,staticClass:"route-item",class:t.showActived(s),style:t.routeItemStyle,on:{click:function(e){return t.routerPush(s.path)}}},[e("svg-icon",{staticClass:"svg",class:s.iconClassName,attrs:{data_iconName:t.$route.path.includes(s.mode)?s.iconActive:s.icon}}),e("div",{staticClass:"right"},[e("div",{staticClass:"top"},[e("span",{staticClass:"route-name"},[t._v(t._s(s.name))]),null!==(o=s.list)&&void 0!==o&&o.created?e("div",{staticClass:"time"},[t._v(t._s(null!==(a=s.list)&&void 0!==a&&a.created?t.$dayjs(s.list.created).format("YYYY/MM/DD HH:mm:ss"):""))]):t._e()]),"interaction"!==s.mode?e("div",{staticClass:"bottom"},[t._v(t._s(t.showDesc(s)||t.$t("toast_not_received")))]):e("div",{staticClass:"bottom",domProps:{innerHTML:t._s(t.showDesc(s)||t.$t("toast_not_received"))}})])],1)})),0),e("div",{staticClass:"list-wrap"},t._l(t.privateList,(function(s,i){var o;return e("div",{key:i,staticClass:"route-item",class:t.showActivedPrivate("/notice/private-letter/"+s.userId),style:t.routeItemStyle,on:{click:function(e){return t.routerPush("/notice/private-letter/"+s.userId)}}},[e("Avatar",{attrs:{avatarSize:48,isShowNickname:!0,"user-id":s.userId,nicknameClass:"nickname",isShowDot:s.isdot}},[e("div",{staticClass:"name-bottom",attrs:{slot:"bottom"},slot:"bottom"},[t._v(" "+t._s(t.handleLink(s.history)||t.$t("toast_not_received"))+" ")])]),e("div",{staticClass:"time absolute"},[t._v(" "+t._s(t.$dayjs(s.history&&(null===(o=s.history[s.history.length-1])||void 0===o?void 0:o.created)).format("YYYY/MM/DD HH:mm:ss"))+" ")])],1)})),0)])}),r=[],n=s("2f62"),c={name:"sidebar-nav-cpn",props:{routesConfig:Object,privateList:Array,routeItemStyle:[Object,String],width:{type:[Number,String],default:300}},data(){return{}},computed:{...Object(n["d"])({siteConfig:t=>t.appSessionStatus.siteConfig})},methods:{routerPush(t){this.$emit("click"),this.$router.push(t)},showActived(t){return this.$route.path.includes(t.mode)?"actived":""},showActivedPrivate(t){return this.$route.path===t?"actived":""},showDesc(t){var e;switch(t.mode){case"platform":return this.showPlatformDesc(t.list);case"interaction":return this.showInteractionDesc(t.list);case"live":return this.$t("toast_reserve_live",[null!==(e=t.list)&&void 0!==e&&e.msgBody?this.parseData(t.list.msgBody,"theme"):""]);case"copy-trade":return this.showCopyTradeDesc(t.list);default:return""}},showPlatformDesc(t){if(!t)return"";const e=this.parseData(t.msgBody,"orderNo"),s=this.parseData(t.msgBody,"coinCode");let i={REGISTER_MESSAGE:this.$t("toast_register_desc"),AUTHENTICATE_SUCCESS:this.$t("toast_authenticate_success_desc"),AUTHENTICATE_FAIL:this.$t("toast_authenticate_fail_desc"),RESET_PASSWORD:this.$t("toast_reset_password_desc"),WORK_ORDER:this.$t("toast_work_order_desc",[e]),withdraw:this.$t("toast_withdraw_desc",[s])};return i[t.outMsgType]||""},showInteractionDesc(t){if(!t)return"";const e=JSON.parse(t.msgBody);return this.$utils.decodeURIComponentSafely("SPEC_REMINDER"==t.outMsgType?e.content:e.body.content||e.body.comment)},showCopyTradeDesc(t){if(!t)return"";switch(t.outMsgType){case"out_team":return this.$t("toast_copy_trade_out_team",[this.parseData(t.msgBody,"userNickNameOtc")]);case"insert_Team":return this.$t("toast_copy_trade_insert_Team",[this.parseData(t.msgBody,"userNickNameOtc")]);case"funding_changes":return this.$t("toast_copy_trade_funding_changes",[this.parseData(t.msgBody,"teamName")]);case"follow_position_change":return this.$t("toast_copy_trade_follow_position_change",[this.parseData(t.msgBody,"teamName")]);case"new_order":return this.$t("toast_copy_trade_new_order",[this.parseData(t.msgBody,"teamName")]);default:return""}},parseData(t,e){return t?JSON.parse(t)[e]:""},handleLink(t){let e="";var s,i;t&&0!==t.length&&(null!==(s=t[t.length-1])&&void 0!==s&&s.msgBody?(t=JSON.parse(null===(i=t[t.length-1])||void 0===i?void 0:i.msgBody),e=0==t.type?t.message:`[${this.$t("community_picture")}]`):e=`[${this.$t("community_picture")}]`);return e}}},u=c,d=(s("efcc"),s("2877")),l=Object(d["a"])(u,a,r,!1,null,"ca78fe66",null),h=l.exports,p=s("8055"),m=s.n(p),_={name:"notice",components:{SidebarNav:h},data(){return{routesConfig:{title:this.$t("notice_title"),routes:[{path:"/notice/platform",name:this.$t("toast_platform_notice"),icon:"notice1",iconActive:"notice",iconClassName:"",mode:"platform",outMsgType:"REGISTER_MESSAGE,AUTHENTICATE_SUCCESS,AUTHENTICATE_FAIL,RESET_PASSWORD,WORK_ORDER,withdraw",list:null},{path:"/notice/interaction",name:this.$t("toast_interact_message"),icon:"hudong1",iconActive:"hudong",iconClassName:"",mode:"interaction",outMsgType:"COMMUNITY_INTERACTION,SPEC_REMINDER",list:null},{path:"/notice/live",name:this.$t("toast_live_message"),icon:"live1",iconActive:"live",iconClassName:"",mode:"live",outMsgType:"LIVE_SHOW",list:null},{path:"/notice/copy-trade",name:this.$t("toast_copy_trade_message"),icon:"gendan1",iconActive:"gendan",iconClassName:"",mode:"copy-trade",outMsgType:"insert_Team,out_team,new_order,follow_position_change",list:null}]},privateList:[]}},computed:{...Object(n["d"])({userInfo:t=>t.userInfo,token:"token"}),_c_isShow_nav_wrap(){return!("/mine/invite-friends"===this.$route.path)}},mounted(){this.getList(),this.socketInt(),this.routesConfig.routes.forEach((t,e)=>{this.listByPage(t.outMsgType,e)})},watch:{"$route.params.id"(t){this.privateList.map(e=>{t==e.userId&&this.$set(e,"isdot",!1)})}},methods:{navClick(){this.routesConfig.routes.forEach((t,e)=>{this.listByPage(t.outMsgType,e)})},async notifyRead(t){await this.$api.notice.readByMsg({toClient:t.toClient,fromClient:t.fromClient,outMsgType:t.outMsgType})},socketInt(){this.Socket=m()(this.$getEnv("VUE_APP_LIVE_SOCKET_URL"),{path:"/message",transports:["websocket","polling"]}),this.Socket.on("connect",()=>{this.token&&this.Socket.emit("login",JSON.stringify({agent:this.$getEnv("VUE_APP_AGENT_SOCKET"),username:this.userInfo.customerId,source:"pc",sex:1,avatar:"tu_o"}))}),this.Socket.on("CHAT_MESSAGE_EVENT",t=>{t.fromClient==this.$route.params.id&&this.notifyRead(t),t.fromClient!=this.userInfo.customerId&&this.privateList.map((e,s)=>{if(e.userId==t.fromClient){let s=e.history||[];s.push(t),this.$set(e,"history",s),this.$route.params.id!==t.fromClient&&this.$set(e,"isdot",!0)}}),t.toClient!=this.userInfo.customerId&&this.privateList.map((e,s)=>{if(e.userId==t.toClient){let s=e.history||[];s.push(t),this.$set(e,"history",s)}})})},async getMsgHistory(t){const e=await this.$api.community.getMsgHistory({targetUserId:t.userId,limit:10});e.success&&(e.obj.length>0&&e.obj[0].fromClient!=this.userInfo.customerId&&(console.log(!e.obj[0].alreadyRead),this.$set(t,"isdot",!e.obj[0].alreadyRead)),this.$set(t,"history",e.obj.reverse()))},async getList(){const t=await this.$api.community.getChatListByFrom();if(this.privateList=[],t.success){const e=[...t.obj.targetUserIds,...t.obj.toMeUseIds];this.$route.params.id&&e.push({userId:this.$route.params.id});const s="userId";this.privateList=e.reduce((t,e)=>t.some(t=>t[s]==e[s])?t:[...t,e],[]),this.privateList.map(t=>{this.getMsgHistory(t)})}},async listByPage(t,e){const s=await this.$api.notice.listByPage({outMsgType:t,pageSize:1,pageNo:1});s.success&&(this.routesConfig.routes[e]["list"]=s.obj.obj[0]||null)}}},v=_,f=(s("6e8d"),Object(d["a"])(v,i,o,!1,null,"c1dd3b64",null));e["default"]=f.exports}}]);